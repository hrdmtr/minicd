<div class="row mb-4">
  <div class="col">
    <h1><%= project.name %></h1>
    <p class="lead"><%= project.repositoryUrl %> (<%= project.branch %> branch)</p>
  </div>
  <div class="col-auto">
    <div class="btn-group">
      <a href="/deployments/trigger/<%= project._id %>" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rocket-takeoff me-1" viewBox="0 0 16 16">
          <path d="M9.752 6.193c.599.6 1.73.437 2.528-.362s.96-1.932.362-2.531c-.599-.6-1.73-.438-2.528.361-.798.8-.96 1.933-.362 2.532"/>
          <path d="M15.811 3.312c-.363 1.534-1.334 3.626-3.64 6.218l-.24 2.408a2.56 2.56 0 0 1-.732 1.526L8.817 15.85a.51.51 0 0 1-.867-.434l.27-1.677c.004-.03-.012-.058-.036-.069-.024-.01-.06-.006-.08.015l-1.827 1.89a.634.634 0 0 1-.926-.08l-.292-.333a.637.637 0 0 1 .08-.926l1.895-1.832a.05.05 0 0 0 .014-.08.05.05 0 0 0-.068-.037l-1.676.27a.51.51 0 0 1-.435-.867l2.386-2.386c.41-.41.947-.67 1.524-.734h.006l2.4-.238C9.005 1.55 11.087.582 12.623.208c.89-.217 1.59-.28 2.056-.22.467.062.865.261 1.15.555.265.292.457.695.512 1.166.056.471-.012 1.176-.229 2.066l-.074.302c.078.57.073 1.322-.123 2.097-.573 2.047-1.27 3.385-2.099 4.426l-.105.105a3.213 3.213 0 0 1-2.266.954 3.23 3.23 0 0 1-2.387-1.068L7.792 8.346c-1.466-1.445-3.07-2.322-4.337-2.317a3.234 3.234 0 0 0-2.287 1.054 3.213 3.213 0 0 0-.742 3.447c.57 1.402 1.628 2.89 2.61 3.953.79.97 1.911 1.742 2.853 1.704.855-.033 1.696-.576 2.262-1.15.566-.574.823-1.16.962-1.917a3.134 3.134 0 0 1 .271-1.171c.13-.257.301-.47.517-.633.217-.165.447-.264.683-.303.236-.039.535-.025.866.08.33.105.607.27.81.506a2.33 2.33 0 0 1 .379.819c.062.26.082.548.06.849a3.546 3.546 0 0 1-.088.7 5.75 5.75 0 0 1-.705 1.927c-.441.81-.98 1.52-1.596 2.041-.864.86-1.898 1.227-2.815 1.196-.916-.03-1.671-.418-2.181-.93L.568 12.211a1.92 1.92 0 0 1-.354-2.324 1.9 1.9 0 0 1 1.004-.952c.535-.226 1.15-.145 1.7.332.358.308.582.741.582 1.182 0 .262-.075.533-.24.81.086-.14.164-.294.207-.456.043-.162.06-.355.019-.533a1.655 1.655 0 0 0-.3-.664 2.004 2.004 0 0 0-.6-.493 2.45 2.45 0 0 0-.71-.263c-.314-.048-.706-.016-1.084.099-.378.115-.719.332-.964.63a2.33 2.33 0 0 0-.436.917 3.464 3.464 0 0 0-.064 1.102 4.1 4.1 0 0 0 .228.97c.113.327.283.68.504 1.035a7.768 7.768 0 0 0 1.898 2.229c1.22 1.1 2.721 1.894 4.312 2.057a5.56 5.56 0 0 0 2.236-.233 6.864 6.864 0 0 0 2.143-1.191 8.62 8.62 0 0 0 1.7-1.913 7.24 7.24 0 0 0 1.003-2.225c.17-.635.24-1.28.21-1.888-.03-.608-.165-1.18-.373-1.678a3.62 3.62 0 0 0-.714-1.181c-.286-.305-.6-.513-.91-.621a2.267 2.267 0 0 0-.853-.104c-.27.015-.518.082-.732.195-.214.113-.397.27-.546.458a1.96 1.96 0 0 0-.33.62c-.064.225-.077.436-.064.65.023.387.088.794.19 1.215.103.421.24.824.405 1.194.33.738.752 1.356 1.238 1.826.485.47 1.033.804 1.605.997.573.193 1.17.245 1.772.157a5.417 5.417 0 0 0 1.812-.597 6.993 6.993 0 0 0 1.618-1.15 7.545 7.545 0 0 0 1.265-1.591 6.995 6.995 0 0 0 .758-1.87 5.668 5.668 0 0 0 .163-1.994A5.168 5.168 0 0 0 14.5 5.674c-.258-.72-.678-1.368-1.234-1.925-.556-.556-1.203-.977-1.924-1.235a5.186 5.186 0 0 0-2.03-.365z"/>
        </svg>
        Deploy Now
      </a>
      <a href="/projects/<%= project._id %>/edit" class="btn btn-outline-secondary">Edit</a>
      <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteProjectModal">Delete</button>
    </div>
  </div>
</div>

<!-- Project Status Card -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Status</h5>
        <% if (project.lastBuildStatus === 'success') { %>
          <span class="badge bg-success">Success</span>
        <% } else if (project.lastBuildStatus === 'failure') { %>
          <span class="badge bg-danger">Failed</span>
        <% } else if (project.lastBuildStatus === 'pending') { %>
          <span class="badge bg-warning text-dark">Pending</span>
        <% } else { %>
          <span class="badge bg-secondary">None</span>
        <% } %>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <dl class="row mb-0">
              <dt class="col-sm-4">Container ID</dt>
              <dd class="col-sm-8">
                <% if (project.containerId) { %>
                  <code><%= project.containerId.substring(0, 12) %></code>
                <% } else { %>
                  <span class="text-muted">None</span>
                <% } %>
              </dd>
              
              <dt class="col-sm-4">Port</dt>
              <dd class="col-sm-8"><%= project.port %></dd>
              
              <dt class="col-sm-4">Status</dt>
              <dd class="col-sm-8">
                <% if (project.isActive) { %>
                  <span class="badge bg-success">Active</span>
                <% } else { %>
                  <span class="badge bg-secondary">Inactive</span>
                <% } %>
              </dd>
            </dl>
          </div>
          <div class="col-md-6">
            <dl class="row mb-0">
              <dt class="col-sm-4">Created</dt>
              <dd class="col-sm-8"><%= new Date(project.createdAt).toLocaleString() %></dd>
              
              <dt class="col-sm-4">Last Updated</dt>
              <dd class="col-sm-8"><%= new Date(project.updatedAt).toLocaleString() %></dd>
              
              <dt class="col-sm-4">Last Deployment</dt>
              <dd class="col-sm-8">
                <% if (project.lastDeployment) { %>
                  <%= new Date(project.lastDeployment).toLocaleString() %>
                <% } else { %>
                  <span class="text-muted">Never</span>
                <% } %>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Deployment History Section -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-header">
        <h5 class="mb-0">Deployment History</h5>
      </div>
      <div class="card-body">
        <% if (deployments && deployments.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Commit</th>
                  <th>Branch</th>
                  <th>Status</th>
                  <th>Triggered By</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% deployments.forEach(deployment => { %>
                  <tr>
                    <td><%= new Date(deployment.startedAt).toLocaleString() %></td>
                    <td>
                      <% if (deployment.commitHash && deployment.commitHash !== 'pending') { %>
                        <code><%= deployment.commitHash.substring(0, 7) %></code>
                      <% } else { %>
                        <span class="text-muted">Pending</span>
                      <% } %>
                    </td>
                    <td><%= deployment.branchName %></td>
                    <td>
                      <% if (deployment.buildStatus === 'success') { %>
                        <span class="badge bg-success">Success</span>
                      <% } else if (deployment.buildStatus === 'failure') { %>
                        <span class="badge bg-danger">Failed</span>
                      <% } else { %>
                        <span class="badge bg-warning text-dark">Pending</span>
                      <% } %>
                    </td>
                    <td>
                      <% if (deployment.triggeredBy === 'push') { %>
                        <span class="badge bg-info">Push</span>
                      <% } else if (deployment.triggeredBy === 'pull_request') { %>
                        <span class="badge bg-info">Pull Request</span>
                      <% } else { %>
                        <span class="badge bg-info">Manual</span>
                      <% } %>
                    </td>
                    <td>
                      <a href="/deployments/<%= deployment._id %>" class="btn btn-sm btn-outline-secondary">View Logs</a>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="text-center py-4">
            <p class="text-muted mb-0">No deployments yet</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<!-- Webhook Section -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-header">
        <h5 class="mb-0">GitHub Webhook Setup</h5>
      </div>
      <div class="card-body">
        <p>To enable automatic deployments, add a webhook in your GitHub repository:</p>
        
        <ol>
          <li>Go to your repository settings on GitHub (Settings &gt; Webhooks &gt; Add webhook)</li>
          <li>Set the Payload URL to:
            <div class="input-group mb-2">
              <input type="text" class="form-control" readonly value="<%= webhookUrl %>" id="webhookUrl">
              <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('webhookUrl')">Copy</button>
            </div>
          </li>
          <li>Set the Content Type to <code>application/json</code></li>
          <li>Set the Secret to the value from your <code>GITHUB_WEBHOOK_SECRET</code> environment variable</li>
          <li>Choose "Just the push event" or select individual events (Push and Pull requests)</li>
          <li>Click "Add webhook"</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Delete Project Modal -->
<div class="modal fade" id="deleteProjectModal" tabindex="-1" aria-labelledby="deleteProjectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteProjectModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the project "<%= project.name %>"?</p>
        <p>This action cannot be undone. All deployment history will be permanently removed.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="/projects/<%= project._id %>/delete" method="POST" class="d-inline">
          <button type="submit" class="btn btn-danger">Delete Project</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for copy to clipboard -->
<script>
function copyToClipboard(elementId) {
  const copyText = document.getElementById(elementId);
  copyText.select();
  copyText.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(copyText.value);
  
  // Optional: Show feedback
  const button = copyText.nextElementSibling;
  const originalText = button.innerText;
  button.innerText = "Copied!";
  setTimeout(() => {
    button.innerText = originalText;
  }, 2000);
}
</script>